# 多线激光雷达与组合惯导外参标定原理

## 引言

在自动驾驶领域中，多线激光雷达与组合惯导是高精地图制作、激光点云定位以及点云物体检测任务中常用的传感器配置。因此精确标定两者之间的外参数具有非常重要的意义。在许多应用中，激光雷达被水平放置于车顶以获得360度的感知范围，而组合惯导也常与车的对称轴以及水平面对齐以简化坐标系的定义，安装方式如图1所示。Apollo开放的多线激光雷达与组合惯导的外参标定工具将主要针对此类安装方式进行优化。

![](images/lidar_calibration/install.png)

<center>图1. 一种典型的传感器安装方式。红色圆表示激光雷达，红色矩形表示IMU。</center>

## 方法

本节将介绍激光雷达与组合惯导外参标定的基本方法。

#### 1. 通过手眼标定获得外参初值

由于多线激光雷达与组合惯导两者的测量之间没有直接的对应，因此需要使用手眼标定的方法对外参的初值进行求解。假设在 $t_i$ 时刻组合惯导的位置姿态为 $T_i^{ins}$ , 使用激光雷达里程计或者SLAM技术得到多线激光雷达的位置为 $T_i^{lidar}$, 则经典的手眼标定问题为求解 $T^{ins}_{lidar}$, 使得:
$$T_{i,i+1}^{ins}T_{lidar}^{ins}=T_{lidar}^{ins}T_{i,i+1}^{lidar}, \tag{1}$$
其中 $T_{i,i+1}^{ins}=T_{i+1}^{ins}(T_{i}^{ins})^{-1}$, $T_{i,i+1}^{lidar}=T_{i+1}^{lidar}(T_{i}^{lidar})^{-1}$ 是两个传感器的相对运动。由于车辆在近似平面内运动，将问题简化为二维的手眼标定问题，则有以下式子成立:
$$(R_{ins}-I)t=Rt_{lidar}-t_{ins}, \tag{2}$$
其中 $R_{ins}$ 和 $t_{ins}$ 分别是组合惯导相对运动的旋转和平移部分, $t_{lidar}$ 是激光雷达相对运动的平移部分, $R$ 和 $t$ 是外参的旋转和平移。令 
$$R=\left(\begin{matrix} cos\theta & -sin\theta\\sin\theta & cos\theta \end{matrix}\right),$$ 
则有:
$$
\left(\begin{array}{c|c} R_{ins}-I & \begin{matrix} -t_{lidar}^x & t_{lidar}^y \\ -t_{lidar}^y & -t_{lidar}^x \end{matrix} \end{array}\right)
\left(\begin{matrix} t^x\\t^y\\cos\theta\\sin\theta\end{matrix}
\right)=-t_{ins}. \tag{3}$$
因此，一次相对运动能构造两个约束，当有三个以上不同位置朝向的运动时，方程满秩，可线性求解。为了保证初值求解以及第二步优化过程中对外参构成足够的约束，算法要求车辆以8字形状的轨迹行驶，如图2所示。注意到车辆在近似平面内运动，因此无法准确标定激光雷达与组合惯导之间的高度差。

![](images/lidar_calibration/trajectory.png)

<center>图2. 标定所需车辆行驶的轨迹。</center>

#### 2. 基于点云拼接质量的外参优化

通过组合惯导的位置姿态信息，结合第一部分求得的外参初值，可以对激光雷达采集的点云进行拼接。由于初值求解误差的存在，不同位置采集的点云拼接后存在对齐误差。具体表现为拼接点云视觉效果模糊、场景中的边缘结构不锐利。为此，算法第二部分将利用优化拼接的方法对外参进行优化。使用经典的GICP以及Entropy的代价函数即可。

